function realtimeData() {
    fetch("https://www.fastmock.site/mock/9549303ba4f3ef5bbe3fe45e6ac47771/ts/realtime").then(e => e.json()).then(e => {
        document.getElementById("online").innerHTML = e.online + " / " + e.total, document.getElementById("avgLatency").innerHTML = e.ping + " ms", document.getElementById("packageLoss").innerHTML = e.loss
    })
}

function serverStatus() {
    fetch("https://www.fastmock.site/mock/9549303ba4f3ef5bbe3fe45e6ac47771/ts/server").then(e => e.json()).then(e => {
        const t = e.map(e => `<div tabindex="0" class="collapse rounded-box ${e.default?'collapse-open" style="margin-top: 5px; margin-bottom: 15px;"':'collapse-arrow"'}><input type="checkbox"> \n                            <div class="collapse-title text-xl font-medium " style="display: flex; align-items: center" id="${e.key}">\n                                ${e.name} <span style="margin-left: 10px" class="w-10 badge badge-sm ${e.status?'badge-success">在线':'badge-error">离线'}</span>\n                            </div>\n                            <div class="collapse-content grid grid-cols-4">\n                                <div class="col-span-3">\n                                    <p>服务器地址：${e.default?e.address : e.address}${(e.port == `
            9987 `)? "" : ":"+e.port}</p>\n                                    <p>${e.description}</p>\n                                </div>\n                                <button class="btn btn-sm col-span-1 ${e.status?"btn-success":"btn-disabled"} " onclick="${e.status?"window.open('ts3server://"+e.address+":"+e.port+"')":"#"}" >连接</button>\n                            </div>\n                        </div>`).join("");
        document.getElementById("server-data").innerHTML = t
    }).catch(e => console.log(e))
}

function updateColorScheme() {
    var now = new Date();
    var hour = now.getHours();
  
    if (hour >= 20 || hour < 6) {
      // 设置为暗黑模式
      document.querySelector("html").dataset.theme = "dark";
    } else {
      // 设置为默认模式
      document.querySelector("html").dataset.theme = "light";
    }
}

// 下载
function downloadFile(fileno) {
    var fileUrl;
    if(fileno == 'client'){
        fileUrl = 'http://43.154.48.215:9000/teamspeak3/3.6.1/TeamSpeak3-Client-win64-3.6.1.exe'
    }
    if(fileno == 'cn'){
        fileUrl = 'http://43.154.48.215:9000/teamspeak3/Chinese_Translation_zh-CN.ts3_translation'
    }
    var now = new Date();
    var now = new Date();
    var link = document.createElement('a');
    link.href = fileUrl;
    link.download = '';
    link.click();
}

document.getElementById("footer-copyright").innerHTML = `<p>Copyright © 2020 - ${(new Date).getFullYear()} </p> <a href="https://beian.miit.gov.cn/" target="_blank">湘ICP备2023021370号</a>`, window.ga_tid = "UA-106121780-10", window.ga_api = "https://ga.cdn.uv.uy/", updateColorScheme(),realtimeData(), serverStatus(), setInterval(realtimeData, 6e4), setInterval(serverStatus, 3e5),
    function(e, t, n) {
        var a = e.screen,
            r = encodeURIComponent,
            o = Math.max,
            s = e.performance,
            i = s && s.timing,
            d = function(e) {
                return isNaN(e) || e == 1 / 0 || e < 0 ? void 0 : e
            },
            c = function(e) {
                return Math.random().toString(36).slice(-e)
            },
            l = function(e) {
                return Math.ceil(Math.random() * (e - 1)) + 1
            };

        function m() {
            var s = [c(l(4)) + "=" + c(l(6)), "ga=" + e.ga_tid, "dt=" + r(t.title), "de=" + r(t.characterSet || t.charset), "dr=" + r(t.referrer), "ul=" + (n.language || n.browserLanguage || n.userLanguage), "sd=" + a.colorDepth + "-bit", "sr=" + a.width + "x" + a.height, "vp=" + o(t.documentElement.clientWidth, e.innerWidth || 0) + "x" + o(t.documentElement.clientHeight, e.innerHeight || 0), "plt=" + d(i.loadEventStart - i.navigationStart || 0), "dns=" + d(i.domainLookupEnd - i.domainLookupStart || 0), "pdt=" + d(i.responseEnd - i.responseStart || 0), "rrt=" + d(i.redirectEnd - i.redirectStart || 0), "tcp=" + d(i.connectEnd - i.connectStart || 0), "srt=" + d(i.responseStart - i.requestStart || 0), "dit=" + d(i.domInteractive - i.domLoading || 0), "clt=" + d(i.domContentLoadedEventStart - i.navigationStart || 0), "z=" + Date.now()];
            e.__ga_img = new Image, e.__ga_img.src = e.ga_api + "?" + s.join("&")
        }
        e.cfga = m, "complete" === t.readyState ? m() : e.addEventListener("load", m)
    }(window, document, navigator);
